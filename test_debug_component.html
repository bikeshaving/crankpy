<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Debug Component Test</title>
    <link rel="stylesheet" href="https://pyscript.net/releases/2025.8.1/core.css">
    <script type="module" src="https://pyscript.net/releases/2025.8.1/core.js"></script>
</head>
<body>
    <div id="test-output"></div>
    
    <mpy-config>
        {
            "files": {
                "./crank/__init__.py": "crank/__init__.py",
                "./crank/dom.py": "crank/dom.py",
                "./crank/typing_stub.py": "crank/typing_stub.py"
            },
            "js_modules": {
                "main": {
                    "https://esm.run/@b9g/crank@0.7.1/crank.js": "crank_core",
                    "https://esm.run/@b9g/crank@0.7.1/dom.js": "crank_dom"
                }
            }
        }
    </mpy-config>
    
    <script type="mpy">
import sys
from js import document, window, eval as js_eval
from pyscript.ffi import create_proxy

output_div = document.getElementById("test-output")

def log_result(message):
    output_div.innerHTML += f"<div>{message}</div>"

log_result(f"Python implementation: {sys.implementation.name}")

try:
    from crank import h, component, createElement
    log_result("✅ Basic imports successful")
    
    # Test what happens when we create a component manually
    @component
    def TestComponent(ctx):
        for _ in ctx:
            yield h.div["Test"]
    
    log_result(f"Component type: {type(TestComponent)}")
    
    # Test creating an element with the component
    element = h(TestComponent)
    log_result(f"Element created: {type(element)}")
    log_result(f"Element tag: {getattr(element, 'tag', 'no tag')}")
    
    # Let's examine what properties the element has
    try:
        element_props = [attr for attr in dir(element) if not attr.startswith('_')]
        log_result(f"Element properties: {element_props[:10]}...")  # Show first 10
    except:
        log_result("Could not examine element properties")
    
    # Test calling the component directly (what Crank.js would do)
    try:
        # Create mock context like Crank would
        from js import Object
        mock_ctx = Object.new()
        mock_props = Object.new()
        
        # Call the component directly
        log_result("Testing direct component call...")
        result = TestComponent(mock_props, mock_ctx)
        log_result(f"Direct call result: {type(result)}")
        
        # Check if result has Symbol.iterator
        from js import Symbol
        iterator_symbol = Symbol.iterator
        try:
            has_iterator = iterator_symbol in result if result else False
            log_result(f"Result has Symbol.iterator: {has_iterator}")
        except Exception as e:
            log_result(f"Error checking Symbol.iterator: {e}")
            
    except Exception as e:
        log_result(f"Direct component call failed: {e}")
    
except Exception as e:
    log_result(f"❌ Test failed: {e}")

log_result("Debug component test completed")
    </script>
</body>
</html>