<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug MicroPython Runtime Detection</title>
    <link rel="stylesheet" href="/tests/pyscript/core.css">
    <script type="module" src="/tests/pyscript/core.js"></script>
</head>
<body>
    <div id="output">Loading...</div>
    
    <py-config type="json">
        {
            "type": "micropython",
            "files": {
                "../../crank/__init__.py": "./crank/__init__.py",
                "../../crank/dom.py": "./crank/dom.py"
            },
            "js_modules": {
                "main": {
                    "https://cdn.jsdelivr.net/npm/@b9g/crank@0.7.1/crank.js": "crank_core",
                    "https://cdn.jsdelivr.net/npm/@b9g/crank@0.7.1/dom.js": "crank_dom"
                }
            }
        }
    </py-config>
    
    <py-script>
        import sys
        from js import document
        from crank import h, ElementBuilder
        
        output = document.getElementById("output")
        
        # Test runtime detection
        output.innerHTML = f"Runtime: {sys.implementation.name}<br>"
        
        # Test our runtime detection function
        builder = ElementBuilder("span")
        is_micropython = builder._is_micropython()
        output.innerHTML += f"_is_micropython(): {is_micropython}<br>"
        
        # Test element building
        try:
            element = h.span(id="test")
            output.innerHTML += f"Created element: {element}<br>"
            output.innerHTML += f"Element type: {type(element)}<br>"
            
            # Test if element is chainable
            try:
                chainable = element["children"]
                output.innerHTML += f"✅ Element is chainable: {type(chainable)}<br>"
            except Exception as e:
                output.innerHTML += f"❌ Element not chainable: {e}<br>"
                
        except Exception as e:
            output.innerHTML += f"❌ Failed to create element: {e}<br>"
    </py-script>
</body>
</html>