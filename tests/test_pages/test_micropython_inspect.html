<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>MicroPython Inspect Test</title>
    <link rel="stylesheet" href="https://pyscript.net/releases/2025.8.1/core.css">
    <script type="module" src="https://pyscript.net/releases/2025.8.1/core.js"></script>
</head>
<body>
    <div id="output"></div>
    
    <mpy-config>
        {}
    </mpy-config>
    
    <script type="mpy">
import sys
from js import document

output_div = document.getElementById("output")

def log(message):
    output_div.innerHTML += f"<div>{message}</div>"

log(f"Python implementation: {sys.implementation.name}")
log(f"Python version: {sys.version}")

# Test inspect module availability
try:
    import inspect
    log("✅ inspect module available")
    
    # Test inspect.signature
    try:
        if hasattr(inspect, 'signature'):
            log("✅ inspect.signature exists")
            
            # Test on a simple function
            def test_func(a, b=10):
                return a + b
            
            try:
                sig = inspect.signature(test_func)
                log(f"✅ inspect.signature works: {sig}")
                log(f"Parameters: {list(sig.parameters.keys())}")
            except Exception as e:
                log(f"❌ inspect.signature failed: {e}")
        else:
            log("❌ inspect.signature does not exist")
    except Exception as e:
        log(f"❌ inspect.signature test failed: {e}")
    
    # Test other inspect functions
    try:
        if hasattr(inspect, 'getargspec'):
            log("✅ inspect.getargspec exists")
        else:
            log("❌ inspect.getargspec does not exist")
    except Exception as e:
        log(f"❌ inspect.getargspec test failed: {e}")
        
except ImportError as e:
    log(f"❌ inspect module not available: {e}")

# Test __code__ object attributes
try:
    def test_func(a, b, c=None):
        return a + b
    
    code_obj = test_func.__code__
    log(f"✅ __code__ object available: {type(code_obj)}")
    
    # Test co_argcount
    try:
        argcount = code_obj.co_argcount
        log(f"✅ co_argcount: {argcount}")
    except AttributeError:
        log("❌ co_argcount not available")
    
    # Test co_varnames  
    try:
        varnames = code_obj.co_varnames
        log(f"✅ co_varnames: {varnames}")
    except AttributeError:
        log("❌ co_varnames not available")
        
    # Test co_filename
    try:
        filename = code_obj.co_filename
        log(f"✅ co_filename: {filename}")
    except AttributeError:
        log("❌ co_filename not available")
        
except Exception as e:
    log(f"❌ __code__ object test failed: {e}")

# Test alternative parameter detection methods
try:
    def test_func2(x, y=5, *args):
        pass
    
    # Try to get parameter info without inspect
    log("Testing alternative parameter detection...")
    
    # Method 1: Try __code__ attributes
    try:
        code = test_func2.__code__
        if hasattr(code, 'co_argcount') and hasattr(code, 'co_varnames'):
            argcount = code.co_argcount
            varnames = code.co_varnames[:argcount]
            log(f"✅ Alternative method 1 works: {argcount} args: {varnames}")
        else:
            log("❌ Alternative method 1 failed: missing co_argcount/co_varnames")
    except Exception as e:
        log(f"❌ Alternative method 1 failed: {e}")
    
    # Method 2: Try function defaults
    try:
        defaults = test_func2.__defaults__
        log(f"✅ __defaults__ available: {defaults}")
    except AttributeError:
        log("❌ __defaults__ not available")
        
except Exception as e:
    log(f"❌ Alternative parameter detection failed: {e}")

log("Test completed")
    </script>
</body>
</html>