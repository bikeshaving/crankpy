<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MicroPython Working Test</title>
    <link rel="stylesheet" href="https://pyscript.net/releases/2024.1.1/core.css">
    <script type="module" src="https://pyscript.net/releases/2024.1.1/core.js"></script>
</head>
<body>
    <h1>MicroPython Test</h1>
    <div id="output">Loading MicroPython...</div>

    <py-config type="json">
        {
            "type": "micropython"
        }
    </py-config>

    <py-script>
        import js
        
        output = js.document.getElementById("output")
        output.innerHTML = "‚úÖ MicroPython is working!<br>"
        
        # Test JS object creation and access
        test_obj = js.Object.new()
        test_obj.name = "test"
        test_obj.value = 42
        
        output.innerHTML += f"Property access: {test_obj.name}, {test_obj.value}<br>"
        
        # Critical test: direct subscripting
        try:
            name_result = test_obj["name"]
            value_result = test_obj["value"]
            output.innerHTML += f"‚úÖ Direct subscripting works! name={name_result}, value={value_result}<br>"
            output.innerHTML += "<br>üéâ MicroPython has native JS subscripting!<br>"
        except Exception as e:
            output.innerHTML += f"‚ùå Direct subscripting fails: {e}<br>"
            
            # Check for as_object_map
            if hasattr(test_obj, 'as_object_map'):
                output.innerHTML += "‚úÖ as_object_map available as fallback<br>"
            else:
                output.innerHTML += "‚ùå No as_object_map fallback<br>"
                
        # Test runtime detection
        try:
            import sys
            output.innerHTML += f"<br>Runtime: {sys.implementation.name}<br>"
        except:
            output.innerHTML += "<br>Runtime: could not detect<br>"
    </py-script>
</body>
</html>