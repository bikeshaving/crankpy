<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Runtime Detection Test</title>
    <link rel="stylesheet" href="https://pyscript.net/releases/2025.8.1/core.css">
    <script type="module" src="https://pyscript.net/releases/2025.8.1/core.js"></script>
</head>
<body>
    <h1>Runtime Detection Methods</h1>
    
    <h2>Pyodide Test</h2>
    <div id="pyodide-output">Loading Pyodide...</div>
    
    <h2>MicroPython Test</h2>
    <div id="micropython-output">Loading MicroPython...</div>

    <!-- Test Pyodide -->
    <script type="py">
        import js
        
        output = js.document.getElementById("pyodide-output")
        output.innerHTML = "Pyodide Runtime Detection:<br><br>"
        
        def log(msg):
            output.innerHTML += msg + "<br>"
        
        # Method 1: sys.implementation.name
        try:
            import sys
            log(f"sys.implementation.name: '{sys.implementation.name}'")
            log(f"sys.version: {sys.version}")
        except:
            log("sys not available")
        
        # Method 2: Module availability
        modules = {
            "pyodide": "import pyodide",
            "micropython": "import micropython", 
            "pyodide.ffi": "import pyodide.ffi",
            "pyscript.ffi": "import pyscript.ffi"
        }
        
        for name, import_stmt in modules.items():
            try:
                exec(import_stmt)
                log(f"✅ {name} available")
            except:
                log(f"❌ {name} not available")
        
        # Method 3: Feature detection
        try:
            from js import Object
            test_obj = Object.new()
            if hasattr(test_obj, 'as_object_map'):
                log("✅ as_object_map available")
            else:
                log("❌ as_object_map not available")
        except:
            log("❌ JS Object test failed")
        
        # Method 4: Platform/version specific
        try:
            import platform
            log(f"platform.python_implementation(): {platform.python_implementation()}")
        except:
            log("platform not available")
    </script>

    <!-- Test MicroPython -->
    <script type="mpy">
        import js
        
        output = js.document.getElementById("micropython-output")
        output.innerHTML = "MicroPython Runtime Detection:<br><br>"
        
        def log(msg):
            output.innerHTML += msg + "<br>"
        
        # Method 1: sys.implementation.name
        try:
            import sys
            log(f"sys.implementation.name: '{sys.implementation.name}'")
            log(f"sys.version: {sys.version}")
        except:
            log("sys not available")
        
        # Method 2: Module availability
        modules = {
            "pyodide": "import pyodide",
            "micropython": "import micropython", 
            "pyodide.ffi": "import pyodide.ffi",
            "pyscript.ffi": "import pyscript.ffi"
        }
        
        for name, import_stmt in modules.items():
            try:
                exec(import_stmt)
                log(f"✅ {name} available")
            except:
                log(f"❌ {name} not available")
        
        # Method 3: Feature detection
        try:
            from js import Object
            test_obj = Object.new()
            if hasattr(test_obj, 'as_object_map'):
                log("✅ as_object_map available")
            else:
                log("❌ as_object_map not available")
        except:
            log("❌ JS Object test failed")
        
        # Method 4: Platform/version specific
        try:
            import platform
            log(f"platform.python_implementation(): {platform.python_implementation()}")
        except:
            log("platform not available")
            
        # Method 5: MicroPython specific features
        try:
            import gc
            log(f"gc module: {gc}")
        except:
            log("gc module not available")
    </script>
</body>
</html>