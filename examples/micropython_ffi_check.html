<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MicroPython FFI Check</title>
    <link rel="stylesheet" href="https://pyscript.net/releases/2024.1.1/core.css">
    <script type="module" src="https://pyscript.net/releases/2024.1.1/core.js"></script>
</head>
<body>
    <h1>MicroPython: FFI Namespace Check</h1>
    <div id="output">Loading...</div>

    <py-config type="json">
        {
            "type": "micropython"
        }
    </py-config>

    <py-script>
        import js
        
        output = js.document.getElementById("output")
        output.innerHTML = "Checking FFI namespace availability<br><br>"
        
        def log(msg):
            output.innerHTML += msg + "<br>"
        
        # Test different FFI namespace availability
        namespaces_to_test = [
            ("pyscript.ffi", "from pyscript.ffi import to_js, create_proxy"),
            ("pyodide.ffi", "from pyodide.ffi import to_js, create_proxy"),
            ("micropython.ffi", "from micropython.ffi import to_js, create_proxy"),
            ("pyscript", "import pyscript"),
            ("pyodide", "import pyodide"),
            ("micropython", "import micropython")
        ]
        
        available_namespaces = []
        
        for name, import_stmt in namespaces_to_test:
            try:
                exec(import_stmt)
                log(f"‚úÖ {name} available")
                available_namespaces.append(name)
            except Exception as e:
                log(f"‚ùå {name} failed: {e}")
        
        log(f"<br>Available namespaces: {available_namespaces}")
        
        # Test what's actually in pyscript if it exists
        try:
            import pyscript
            log(f"<br>pyscript dir: {dir(pyscript)}")
        except:
            log("<br>pyscript not available")
            
        # Test what's actually in pyodide if it exists  
        try:
            import pyodide
            log(f"<br>pyodide dir: {dir(pyodide)}")
        except:
            log("<br>pyodide not available")
            
        # Try to find working FFI functions
        working_ffi = None
        
        ffi_tests = [
            ("pyscript.ffi", lambda: __import__('pyscript.ffi', fromlist=['to_js', 'create_proxy'])),
            ("pyodide.ffi", lambda: __import__('pyodide.ffi', fromlist=['to_js', 'create_proxy'])),
        ]
        
        for name, test_func in ffi_tests:
            try:
                ffi_module = test_func()
                if hasattr(ffi_module, 'to_js') and hasattr(ffi_module, 'create_proxy'):
                    log(f"<br>‚úÖ Working FFI found: {name}")
                    working_ffi = name
                    break
            except:
                pass
                
        if working_ffi:
            log(f"<br>üéâ Can use {working_ffi} for our crank module!")
        else:
            log("<br>‚ùå No working FFI found")
    </py-script>
</body>
</html>