<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>hasattr Debug</title>
    <link rel="stylesheet" href="https://pyscript.net/releases/2025.8.1/core.css">
    <script type="module" src="https://pyscript.net/releases/2025.8.1/core.js"></script>
</head>
<body>
    <div id="test-output"></div>
    
    <mpy-config>
        {
            "js_modules": {
                "main": {
                    "https://esm.run/@b9g/crank@0.7.1/crank.js": "crank_core"
                }
            }
        }
    </mpy-config>
    
    <script type="mpy">
import sys
from js import document, Object, console

output_div = document.getElementById("test-output")

def log_result(message):
    output_div.innerHTML += f"<div>{message}</div>"
    console.log(message)

log_result(f"Python implementation: {sys.implementation.name}")

try:
    log_result("üîç Testing hasattr on JsProxy objects...")
    
    # Create a simple JsProxy object
    test_obj = Object.new()
    log_result(f"Created test object: {type(test_obj)}")
    
    # Test hasattr on different attributes
    test_attrs = ['to_py', 'toString', 'nonexistent', 'length', 'constructor']
    
    for attr in test_attrs:
        log_result(f"Testing hasattr(obj, '{attr}')...")
        try:
            result = hasattr(test_obj, attr)
            log_result(f"‚úÖ hasattr(obj, '{attr}') = {result}")
        except Exception as e:
            log_result(f"‚ùå hasattr(obj, '{attr}') failed: {e}")
    
    log_result("Testing getattr with default...")
    try:
        result = getattr(test_obj, 'to_py', None)
        log_result(f"‚úÖ getattr(obj, 'to_py', None) = {result}")
    except Exception as e:
        log_result(f"‚ùå getattr(obj, 'to_py', None) failed: {e}")
    
    log_result("Testing direct attribute access...")
    try:
        result = test_obj.to_py if hasattr(test_obj, 'to_py') else None
        log_result(f"‚úÖ Direct access succeeded: {result}")
    except Exception as e:
        log_result(f"‚ùå Direct access failed: {e}")
    
    # Test try/except approach
    log_result("Testing try/except approach...")
    try:
        result = test_obj.to_py
        log_result(f"‚úÖ try/except - obj.to_py exists: {result}")
    except AttributeError:
        log_result("‚úÖ try/except - obj.to_py doesn't exist")
    except Exception as e:
        log_result(f"‚ùå try/except failed: {e}")
    
except Exception as e:
    log_result(f"‚ùå Test setup failed: {e}")

log_result("hasattr debug completed")
    </script>
</body>
</html>