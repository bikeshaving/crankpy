<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>MicroPython dict() Bug - Minimal Reproduction</title>
    <link rel="stylesheet" href="https://pyscript.net/releases/2025.8.1/core.css">
    <script type="module" src="https://pyscript.net/releases/2025.8.1/core.js"></script>
</head>
<body>
    <h1>MicroPython dict() on JsProxy Bug</h1>
    <div id="output"></div>
    
    <mpy-config>
        {}
    </mpy-config>
    
    <script type="mpy">
import sys
from js import document, Object, console

output_div = document.getElementById("output")

def log(message):
    output_div.innerHTML += f"<div>{message}</div>"
    console.log(message)

log(f"Python implementation: {sys.implementation.name}")

try:
    log("Creating JavaScript object with properties...")
    js_obj = Object.new()
    js_obj.prop1 = "value1"
    js_obj.prop2 = "value2"
    log(f"Created object: {type(js_obj)}")
    
    log("Calling dict() on JsProxy object...")
    # This triggers: TypeError: proxy_js_ref[f_ref][Symbol.iterator] is not a function
    python_dict = dict(js_obj)
    log(f"✅ dict() succeeded: {python_dict}")
    
except Exception as e:
    log(f"❌ dict() failed: {e}")
    log("BUG: dict() constructor on JsProxy objects triggers js_get_iter Symbol.iterator error")

log("Reproduction complete")
    </script>
</body>
</html>